{% extends "admin/base.html" %}

{% block title %}{% if subtitle %}{{ subtitle }} | {% endif %}{{ title }} | {{ site_title|default:_('Django site admin') }}{% endblock %}

{% block branding %}
<div id="site-name">
    <a href="{% url 'admin:index' %}">{{ site_header|default:_('Django administration') }}</a>
    <span class="home-link"><a href="{% url 'homepage' %}">Back to site</a></span>
    {% if user.is_staff %}
    <div class="manual-backup-actions">
        <form method="post" action="{% url 'manual_backup' %}" class="manual-backup-form" id="manual-backup-form">
            {% csrf_token %}
            <button type="submit" class="manual-backup-button" id="manual-backup-button">Trigger Manual Backup</button>
        </form>
        <a href="{% url 'manual_restore' %}" class="manual-restore-button" id="manual-restore-button">Restore Backup</a>
        <form method="post" action="{% url 'refresh_sitemap' %}" class="refresh-sitemap-form" id="refresh-sitemap-form">
            {% csrf_token %}
            <button type="submit" class="refresh-sitemap-button" id="refresh-sitemap-button">Refresh Sitemap</button>
        </form>
    </div>
    {% endif %}
</div>
{% if user.is_anonymous %}
  {% include "admin/color_theme_toggle.html" %}
{% endif %}
{% endblock %}

{% block extrastyle %}
{{ block.super }}
<style>
#site-name {
    display: flex;
    align-items: center;
    gap: 1rem;
}
#site-name .manual-backup-actions {
    display: flex;
    align-items: center;
    gap: 0.75rem;
}
#site-name .manual-backup-form,
#site-name .refresh-sitemap-form {
    margin: 0;
}
#site-name .refresh-sitemap-form {
    margin-left: 1.25rem;
}
#site-name .manual-backup-button {
    background-color: #0b7dda;
    border: none;
    border-radius: 4px;
    color: white;
    cursor: pointer;
    font-size: 0.875rem;
    padding: 0.35rem 0.75rem;
}
#site-name .manual-backup-button:hover,
#site-name .manual-backup-button:focus {
    background-color: #095fa7;
}
#site-name .refresh-sitemap-button {
    background-color: #059669;
    border: none;
    border-radius: 4px;
    color: white;
    cursor: pointer;
    font-size: 0.875rem;
    padding: 0.35rem 0.75rem;
}
#site-name .refresh-sitemap-button:hover,
#site-name .refresh-sitemap-button:focus {
    background-color: #047857;
}
#site-name .refresh-sitemap-button[disabled] {
    background-color: #0f5132;
    cursor: wait;
    opacity: 0.85;
}
#site-name .manual-restore-button {
    background-color: #1f2937;
    border-radius: 4px;
    color: #fff;
    font-size: 0.875rem;
    padding: 0.35rem 0.75rem;
    text-decoration: none;
}
#site-name .manual-restore-button:hover,
#site-name .manual-restore-button:focus {
    background-color: #111827;
}
#site-name .manual-backup-button[disabled] {
    background-color: #5e7f99;
    cursor: wait;
    opacity: 0.85;
}
#site-name .manual-backup-status {
    color: #1f2937;
    font-size: 0.8125rem;
}
.manual-backup-overlay {
    align-items: center;
    background: rgba(15, 23, 42, 0.45);
    display: flex;
    inset: 0;
    justify-content: center;
    position: fixed;
    z-index: 2000;
}
.manual-backup-overlay__label {
    background: #ffffff;
    border-radius: 8px;
    box-shadow: 0 10px 25px rgba(15, 23, 42, 0.25);
    color: #0f172a;
    font-size: 1rem;
    font-weight: 600;
    padding: 1rem 1.5rem;
}
#site-name .home-link a {
    font-size: 0.875rem;
    color: inherit;
    text-decoration: underline;
}
#site-name .home-link a:focus,
#site-name .home-link a:hover {
    text-decoration: none;
}
</style>
{% endblock %}

{% block extrahead %}
{{ block.super }}
<script>
document.addEventListener('DOMContentLoaded', function () {
    function attachAsyncForm(formId, options) {
        const form = document.getElementById(formId);
        if (!form) {
            return;
        }
        form.addEventListener('submit', function () {
            const button = document.getElementById(options.buttonId);
            if (button) {
                button.disabled = true;
                button.dataset.originalText = button.textContent;
                button.textContent = options.busyButtonText;
                if (options.statusText) {
                    const status = document.createElement('span');
                    status.className = 'manual-backup-status';
                    status.textContent = options.statusText;
                    button.insertAdjacentElement('afterend', status);
                }
            }

            const overlay = document.createElement('div');
            overlay.className = 'manual-backup-overlay';
            const label = document.createElement('div');
            label.className = 'manual-backup-overlay__label';
            label.textContent = options.overlayText;
            overlay.appendChild(label);
            document.body.appendChild(overlay);
        }, { once: true });
    }

    attachAsyncForm('manual-backup-form', {
        buttonId: 'manual-backup-button',
        busyButtonText: 'Backing up...',
        statusText: ' Working...',
        overlayText: 'Creating manual backup...',
    });

    attachAsyncForm('refresh-sitemap-form', {
        buttonId: 'refresh-sitemap-button',
        busyButtonText: 'Refreshing...',
        statusText: ' Working...',
        overlayText: 'Refreshing sitemap...',
    });
});
</script>
{% endblock %}

{% block nav-global %}{% endblock %}
